<link rel="import" href="../bower_components/polymer/polymer.html">

<dom-module id="lynleser-booklist">
  <template>
    <style>
      :host { display: block; }
      div { margin-bottom: 20px; }
    </style>

    <h2>User books</h2>
    <template is="dom-repeat" items="[[organizedBooks.userBooks]]">
      <div class="systemBook" data-filename$="[[item.filename]]" on-click="_clickSystemBook">
        [[item.key]], [[item.name]], [[item.filename]], [[item.position]]
      </div>
    </template>
    <h2>All books</h2>
    <template is="dom-repeat" items="[[organizedBooks.systemBooks]]">
      <div class="systemBook" data-filename$="[[item.filename]]" on-click="_clickSystemBook">
        [[item.key]], [[item.name]], [[item.filename]], [[item.position]]
      </div>
    </template>

  </template>
  <script>
    class OrganizedBooklist {
      constructor(systemBooks, userBooks){
        let userBookKeys = Object.keys(userBooks);
        this.userBooks = userBookKeys.map(key => Object.assign({key: key}, systemBooks[key], userBooks[key]));
        let systemBookKeys = Object.keys(systemBooks);
        let filteredSystemBookKeys = systemBookKeys.filter(systemKey => userBookKeys.indexOf(systemKey));
        this.systemBooks = filteredSystemBookKeys.map(key => Object.assign({key: key}, systemBooks[key]));
      }
    }

    class LynleserBooklist extends Polymer.Element {
      static get is() {
        return "lynleser-booklist";
      }


      static get config() {
        return {
          properties: {
            userBooks: Array,
            systemBooks: Array,
            organizedBooks: {
              type: OrganizedBooklist,
              computed: "_makeOrganizedBookList(systemBooks, userBooks)"
            }
          },
          //observers: []
        };
      }

      _makeOrganizedBookList(systemBooks, userBooks){
        return new OrganizedBooklist(systemBooks || [], userBooks || []);
      }

      _clickSystemBook(e) {
        this.dispatchEvent(new CustomEvent("select-book", {composed: true, bubbles: true, detail: e.target.dataset.filename}));
      }
    }
    customElements.define(LynleserBooklist.is, LynleserBooklist);
  </script>
</dom-module>