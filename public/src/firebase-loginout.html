<dom-module id="firebase-loginout">
  <script>
    class FirebaseLoginout extends Polymer.Element {

      static get is() {
        return "firebase-loginout";
      }

      static get properties() {
        return {
          user: {
            type: Object,
            notify: true,
          },
          provider: {
            type: Object,
            value: function() {
              return new firebase.auth.GoogleAuthProvider();
            }
          }
        };
      }

      connectedCallback() {
        super.connectedCallback();
        firebase.auth().onAuthStateChanged(function(user) {
          if (user) {
            this.set("user", user);
          } else {
            console.log("unsigned");
          }
        }.bind(this));
      }

      signIn() {
        firebase.auth().signInWithPopup(this.provider).then(function (result) {
          // This gives you a Google Access Token. You can use it to access the Google API.
          // let token = result.credential.accessToken;
          this.set("user", result.user);
        }.bind(this)).catch(this._fire.bind(this, "system-error"));
      }

      signOut() {
        firebase.auth().signOut().then(function () {
          this.set("user", null);
        }.bind(this)).catch(this._fire.bind(this, "system-error"));
      }

      _fire(name, detail){
        this.dispatchEvent(new CustomEvent(name, {composed: true, bubbles: true, detail: detail}));
      }
    }
    customElements.define(FirebaseLoginout.is, FirebaseLoginout);
  </script>
</dom-module>