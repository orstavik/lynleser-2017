<link rel="import" href="../bower_components/polymer/polymer.html">

<link rel="import" href="controller-transient.html">
<link rel="import" href="lynleser-auth.html">
<link rel="import" href="lynleser-firebase.html">

<dom-module id="my-app">
  <template>
    <style>
      :host {
        display: block;
      }
    </style>

    <lynleser-firebase id="firebase"
                       system-books="{{systemBooks}}"
                       server-user="{{serverUser}}"
                       user-data="{{userData}}"

                       on-system-error="_systemError"
                       on-loaded-book="_loadedBook"></lynleser-firebase>

    <lynleser-auth user="[[serverUser]]" on-sign-in="_signIn" on-sign-out="_signOut"></lynleser-auth>

    <controller-transient id="ui"
                          system-books="[[systemBooks]]"
                          user-data="[[userData]]"
                          on-select-book="_selectBook"
                          on-settings-changed="_userSetNewSettings"></controller-transient>
  </template>

  <script>

    class MyApp extends Polymer.Element {
      static get is() {
        return "my-app";
      }

      static get properties() {
        return {
          serverUser: Object,
          systemBooks: Array,
          userData: Object
        };
      }

      _signIn(e) {
        this.$.firebase.signIn();
      }

      _signOut(e) {
        this.$.firebase.signOut();
      }

      _selectBook(e) {
        this.$.firebase.getBook(e.detail);
      }

      _loadedBook(e) {
        this.$.ui.loadContent(e.detail);
      }

      _systemError(e) {
        console.log("Error");
        console.log(e);
      }

      _userSetNewSettings(e) {
        if (this.serverUser)
          this.$.firebase.updateSettings(e.detail);
      }
    }
    customElements.define(MyApp.is, MyApp);
  </script>
</dom-module>