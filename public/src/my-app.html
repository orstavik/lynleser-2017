<link rel="import" href="../bower_components/polymer/polymer.html">

<link rel="import" href="controller-transient.html">
<link rel="import" href="lynleser-auth.html">
<link rel="import" href="lynleser-firebase.html">
<link rel="import" href="lynleser-booklist.html">
<link rel="import" href="lynleser-fulltext.html">
<link rel="import" href="lynleser-settings.html">
<link rel="import" href="lynleser-joystick.html">

<dom-module id="my-app">
  <template>
    <style>
      :host {
        display: block;
      }
    </style>

    <lynleser-firebase id="firebase"
                       system-books="{{systemBooks}}"
                       server-user="{{serverUser}}"
                       user-data="{{userData}}"

                       on-system-error="_systemError"
                       on-loaded-book="_loadedBook"></lynleser-firebase>

    <lynleser-auth user="[[serverUser]]" on-sign-in="_signIn" on-sign-out="_signOut"></lynleser-auth>

    <lynleser-booklist system-books="[[systemBooks]]"
                       user-books="[[userData.books]]"

                       on-select-book="_selectBook"></lynleser-booklist>

    <lynleser-settings id="settings"
                       settings="[[userData.settings]]"
                       on-settings-changed="_userSetNewSettings"></lynleser-settings>

    <lynleser-fulltext id="fullText"></lynleser-fulltext>

    <lynleser-joystick id="joystick"
                       on-speed-change="_speedChange"
                       on-word-wider="_wordWider"
                       on-start-stop="_startStop"></lynleser-joystick>

    <controller-transient prop1="[[test]]"></controller-transient>
  </template>

  <script>

    class MyApp extends Polymer.Element {
      static get is() {
        return "my-app";
      }

      static get properties() {
        return {
          serverUser: Object,
          systemBooks: Array,
          userData: Object,
          test: {
            type: String,
            value: "yooyo tirsdag"
          }
        };
      }

      _signIn(e) {
        this.$.firebase.signIn();
      }

      _signOut(e) {
        this.$.firebase.signOut();
      }

      _selectBook(e) {
        this.$.firebase.getBook(e.detail);
      }

      _loadedBook(e) {
        this.$.fullText.loadContent(e.detail);
      }

      _systemError(e) {
        console.log("Error");
        console.log(e);
      }

      _wordWider(e){
        console.log(e);
      }

      _speedChange(e){
        console.log(e);
      }

      _startStop(e){
        console.log(e);
      }

      _userSetNewSettings(e) {
        if (this.serverUser)
          this.$.firebase.updateSettings(e.detail);
      }
    }
    customElements.define(MyApp.is, MyApp);
  </script>
</dom-module>