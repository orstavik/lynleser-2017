<dom-module id="controller-route">
  <script>
    class ControllerRoute extends Polymer.Element {

      static get is() {
        return "controller-route";
      }

      static get properties() {
        return {
          _hashOut: Object,
          route: {
            type: Object,
            computed: "_makeRouteState(_hashOut)"
          }
        };
      }

      constructor(){
        super();
        this.set("_hashOut", location.hash.substr(2));
        window.addEventListener("hashchange", this._locationBarChanged.bind(this), false);
      }

      openPage(hash){
        if (hash !== this._hashOut)
          window.history.pushState({}, null, '/#/' + hash);
      }

      _locationBarChanged(e){
        this.set("_hashOut", location.hash.substr(2));
      }

      _makeRouteState(hash) {
        return {route: this._parseHash(hash)};
      }

      _parseHash(hash) {
        let Arr = hash.split("?");
        let path = {};
        Arr[0].split("/").forEach(function(each, index) {
          path["segment"+index] = each;
        });
        let query = {};
        Arr[1].split("&").forEach(function(each) {
          let arr = each.split("=");
          query[arr[0]] = arr[1];
        });
        console.log({
          path: path,
          query: query
        });
        return {
          path: path,
          query: query
        }
      }
    }
    customElements.define(ControllerRoute.is, ControllerRoute);
  </script>
</dom-module>