<link rel="import" href="lynleser-booklist.html">
<link rel="import" href="lynleser-fulltext.html">
<link rel="import" href="lynleser-settings.html">
<link rel="import" href="lynleser-joystick.html">
<link rel="import" href="lynleser-auth.html">

<dom-module id="controller-transient">
  <template>
    <style>
      :host { display: block; }
      #settings, #login, #books {
        position: absolute;
        overflow: hidden;
        background: grey;
        left: 0;
        width: 100px;
        height: 60px;
      }
      #settings:hover, #login:hover, #books:hover {
        width: auto;
        height: auto;
        z-index: 2;
      }
      #login { top: 0; }
      #books { top: 60px; }
      #settings { top: 120px; }
      #fullText {
        margin-left: 100px;
        height: 100vh;
      }
    </style>

    <lynleser-auth id="login" user="[[user]]"></lynleser-auth>
    <lynleser-booklist id="books" data="[[userData]]"></lynleser-booklist>
    <lynleser-settings id="settings" settings="[[userData.settings]]"></lynleser-settings>

    <lynleser-fulltext id="fullText"
                       book="[[userData.book]]"></lynleser-fulltext>

    <lynleser-joystick id="joystick"
                       on-speed-change="_speedChange"
                       on-word-wider="_wordWider"
                       on-start-stop="_startStop"></lynleser-joystick>
  </template>
  <script>
    class ControllerTransient extends Polymer.Element {

      static get is() {
        return "controller-transient";
      }

      static get properties() {
        return {
          user: Object,
          userData: Object,
          book: Object
        };
      }

      _startStop(e) {
        console.log(e);
      }

      _wordWider(e) {
        const val = this.userData.settings["wordWidth"] + e.detail;
        this._fire("settings-changed", {key: "wordWidth", value: val});
      }

      _speedChange(e) {
        let value = this.userData.settings["speed"] * (1 + (e.detail / 100));
        this._fire("settings-changed", {key: "speed", value: value});
      }

      _fire(name, detail) {
        this.dispatchEvent(new CustomEvent(name, {composed: true, bubbles: true, detail: detail}));
      }
    }
    customElements.define(ControllerTransient.is, ControllerTransient);
  </script>
</dom-module>