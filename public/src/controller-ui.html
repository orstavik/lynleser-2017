<link rel="import" href="ui/lynleser-booklist.html">
<link rel="import" href="ui/lynleser-fulltext.html">
<link rel="import" href="ui/lynleser-settings.html">
<link rel="import" href="ui/lynleser-joystick.html">
<link rel="import" href="ui/lynleser-auth.html">
<link rel="import" href="ui/lynleser-controller.html">

<dom-module id="controller-ui">
  <template>
    <style>
      :host { display: block; }
      #settings, #login, #books {
        position: absolute;
        overflow: hidden;
        background: grey;
        left: 0;
        width: 100px;
        height: 60px;
      }
      #settings:hover, #login:hover, #books:hover {
        width: auto;
        height: auto;
        z-index: 2;
      }
      #login { top: 0; }
      #books { top: 60px; }
      #settings { top: 120px; }
      #fullText {
        margin-left: 100px;
        height: 100vh;
      }
    </style>
    <lynleser-controller on-tick="_tick"></lynleser-controller>

    <lynleser-auth id="login" user="[[user]]"></lynleser-auth>
    <lynleser-booklist id="books"
                       books="[[state.books]]"
    on-select-book="_selectBook"></lynleser-booklist>
    <lynleser-settings id="settings" settings="[[state.settings]]"></lynleser-settings>
    <lynleser-fulltext id="fullText" book="[[state.activeBook]]"></lynleser-fulltext>
    <lynleser-joystick id="joystick"
                       on-speed-change="_speedChange"
                       on-word-wider="_wordWider"
                       on-start-stop="_startStop"></lynleser-joystick>
  </template>
  <script>
    class ControllerUI extends Polymer.Element {

      static get is() {
        return "controller-ui";
      }

      static get properties() {
        return {
          user: Object,
          state: State
        };
      }

      _tick(e) {
        e.stopPropagation();
        this._fire("new-book-position", this.state.nextBookPosition());
      }

      _startStop(e) {
        console.log(e);
      }

      _selectBook(e){
        this._fire("settings-changed", this.state.newSettingRes("activeBook", e.detail));
      }

      _wordWider(e) {
        const newWidth = this.state.settings.wordWidth + e.detail;
        this._fire("settings-changed", this.state.newSettingRes("wordWidth", newWidth));
      }

      _speedChange(e) {
        const newSpeed = this.state.settings.wordWidth * (1 + (e.detail / 100));
        this._fire("settings-changed", this.state.newSettingRes("speed", newSpeed));
      }

      _fire(name, detail) {
        this.dispatchEvent(new CustomEvent(name, {composed: true, bubbles: true, detail: detail}));
      }
    }
    customElements.define(ControllerUI.is, ControllerUI);
  </script>
</dom-module>